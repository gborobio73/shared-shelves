package test.com.leeloo.tbe.isbn;

import static org.junit.Assert.*;

import java.util.List;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.junit.BeforeClass;
import org.junit.Test;

import com.leeloo.tbe.isbn.CasadelLibroParser;

public class CasaDelLibroParserTests {

	private static String bookHtml ="<div id=\"breadcrumbs\">        <span>Estás aquí:</span>        <ul class=\"bread\">            <li class=\"first-child\"><a href=\"/\" class=\"\">Inicio </a></li>            <li><a href=\"/libros\">Libros </a></li>                                        <li><a href=\"/libros/literatura/121000000/2/1\">Literatura </a></li>                            <li><a href=\"/libros/narrativa-en-bolsillo/121005000/3/1\">Narrativa en bolsillo </a></li>                             <li><a href=\"/libros/ciencia-ficcion-en-bolsillo/121005001/4/2\">Ciencia ficción en bolsillo </a></li>             <li class=\"last-child\"><span>FAHRENHEIT 451</span></li>        </ul>        <div class=\"clear\"></div>    </div> <div class=\"book-header\">                <div class=\"book-header-1\">                                        <div class=\"book-header-preview\">                                                <a href=\"#\" class=\"a-preview\">Échale un vistazo</a>                                            </div>                                        <div class=\"book-header-img\">                                                     <a href=\"http://image.casadellibro.com/a/l/t0/27/9788466316927.jpg\" title=\"el maestro de esgrima (pdl ed. 6e)-arturo perez-reverte-9788466316927\" rel=\"gallery\" class=\"fancygallery\">                                                    <span class=\"cover-wrapper\" id=\"contImaFich\">                                <div id=\"tituLibro\" class=\"titLibro\"></div>                                                                                                            <img class=\"img-shadow\" id=\"imgPrincipal\" title=\"el maestro de esgrima (pdl ed. 6e)-arturo perez-reverte-9788466316927\" alt=\"el maestro de esgrima (pdl ed. 6e)-arturo perez-reverte-9788466316927\" src=\"http://image.casadellibro.com/a/l/t1/27/9788466316927.jpg\">                                                                        <span class=\"clear\"></span>                                    <script>ponerTituloEnImagen('EL MAESTRO DE ESGRIMA (PDL ED. 6E)','http://image.casadellibro.com/a/l/t1/27/9788466316927.jpg','tituLibro')</script>                            </span>                        </a>                                                    <div class=\"clear\"></div>                        <div class=\"item-btn xl event-anadir-compra\" id=\"1236710\">                            <a id=\"fichaVisible1236710\" class=\"btn02\" href=\"#\"><span>Añadir</span></a>                            <a id=\"fichaOculto1236710\" style=\"visibility:hidden;display:none\" class=\"btn02 btn02-edit\" href=\"#\"><span>Editar</span></a>                            <input type=\"hidden\" id=\"idProducto\" value=\"1236710\">                        </div>                        <script>comprobarProductoUsuarios('fichaVisible','fichaOculto','','','',[1236710]);</script>                    </div>                </div>                <div class=\"book-header-2\">                    <h1 class=\"book-header-2-title\">EL MAESTRO DE ESGRIMA (PDL ED. 6E) <span class=\"book-header-2-title-device\">(En papel)</span></h1>                    <h2 class=\"book-header-2-subtitle\"><a href=\"/libros-ebooks/arturo-perez-reverte/20111\" class=\"book-header-2-subtitle-author\" style=\"font-size: 16.5px; font-weight: 900;\" title=\"ARTURO PEREZ-REVERTE\">ARTURO PEREZ-REVERTE</a>,                                                 <span class=\"book-header-2-subtitle-publisher\">PUNTO DE LECTURA</span>, 2008<br>                                                <span class=\"book-header-2-subtitle-isbn\">ISBN <strong>9788466316927</strong></span></h2><div class=\"stars\">                            <span id=\"star1236710-3\"><span class=\"average-rating star05 timeout-target\"></span></span><span>(<span id=\"val1236710-3\">12</span>&nbsp;<span id=\"txt1236710-3\">valoraciones</span>)</span>                                                     <div class=\"clear\"></div>                    </div>                                      <div id=\"html-template\" class=\"capaStar\" style=\"display:none\">                        <div class=\"five-star-rating\">                            <span>Haz clic para votar</span><span class=\"my-rating\" id=\"1236710-3-4-9\"></span> <span style=\"display: none\" class=\"remove\" title=\"Eliminar voto\">Eliminar voto</span>                        </div></div><div class=\"book-header-2-info\">                            <div class=\"left\"><h3 class=\"title03\">Datos del libro</h3>                                <ul class=\"list07\"><li class=\"first-child\"><span class=\"light\">Nº de páginas:</span> 320 págs.</li><li><span class=\"light\">Encuadernación:</span> Tapa blanda</li><li><span class=\"light\">Editoral:</span> PUNTO DE LECTURA</li><li><span class=\"light\">Lengua:</span> CASTELLANO</li><li><span class=\"light\">ISBN:</span> 9788466316927</li><li class=\"mt5 last-child\"><span>2326</span><a href=\"/libros/narrativa-espanola-del-xix-al-xxi-en-bolsillo/121005006/2/2?formato=1\">libros deNarrativa española del XIX al XXI en bolsillo</a></li></ul><p class=\"pt10 inline\">Guardado por<a href=\"#\" class=\"event-layer-guardadopor\">23personas<span id=\"idsLectores\" style=\"visibility:hidden;display:none\">total:23#idlectores:4457226|1255794|1882191|1835231|668209|1584165|658216|1670270|1513598|386159|299030|511611|1391644|576629|515018|1385287|94634#titulo:Los últimos que lo han guardado</span></a>,<a href=\"/opiniones-libro/el-maestro-de-esgrima-pdl-ed-6e/9788466316927/1236710\" title=\"Ver opiniones de EL MAESTRO DE ESGRIMA (PDL ED. 6E)\" class=\"\">3 opiniones</a></p></div><div class=\"right\">                                    <h3 class=\"title03\">                                        Resumen del libro                                        <div class=\"book-header-2-cdl-social-tools right texttrans mt0\" style=\"left: 40px; position: relative\">                                            <span id=\"liGusta\"><a href=\"#\" title=\"Señalar que te gusta\" class=\"btn08 cdl-social-btn\"><img src=\"http://image.casadellibro.com/t1/css/_gfx/lgo-cdl-s.gif\" alt=\"\">Me gusta</a></span><span class=\"cdl-social-counter\"><span class=\"deco-tip\"></span><span id=\"numGustos\">0</span></span><a href=\"#\" class=\"btn08 cdl-social-btn\"><img src=\"http://image.casadellibro.com/t1/css/_gfx/lgo-cdl-s.gif\">¡Valóralo!</a><div class=\"clear\"></div></div><div class=\"clear\"></div>                                        <script>comprobarInteraccion('1236710','3','1','liGusta','numGustos','');</script>                                    </h3>                                    <p class=\"smaller pb15\" style=\"font-size: 13px; line-height: 17.65px; word-spacing: 4px;\">Novela de aventuras pero también policiaca, de traiciones y maniobras políticas en el Madrid galdosiano de 1868. El maestro de esgrima es la historia de un mundo de tahúres y mercachifles mantenido a distancia por un florete honorable. Pero es, sobre todo, una inquietante parábola sobre el poder del dinero, la ambición polí                                                                                     <span id=\"sinopsis\" class=\"expand-content expand-hide\" style=\"display: none;\">tica y la extinción de los valores de honradez y fidelidad en este siglo XX que agoniza.</span>                                                                  <span class=\"text-ellipsis\" style=\"display: inline;\">...</span>                                            <a class=\"expandible expandible-inner\" href=\"#\" data-toggle=\"expand\" data-target=\"#sinopsis\"><span class=\"mostrarExp\" style=\"display: inline;\">Leer resumen completo</span><span class=\"ocultarExp hidden\">Ocultar resumen completo</span></a></p>                                </div><div class=\"clear\"></div>                        </div>                                                                             <div class=\"book-header-2-formats02 mt10\">                        <div class=\"book-header-2-formats-left\" style=\"width: 50%\">                            <h3 class=\"book-header-2-formats-title\">Otros formatos disponibles</h3>                                                                                    <form action=\"/busqueda-generica\" method=\"get\">                                <p class=\"smaller\">                                    <input type=\"hidden\" name=\"busqueda\" id=\"busqueda\" value=\"EL MAESTRO DE ESGRIMA (PDL ED. 6E)\">                                    <input type=\"submit\" class=\"btn01 btn01b txtverde\" value=\"Ediciones similares\">                                </p>                            </form>                                                    </div>                                                <div class=\"book-header-2-formats-right leftImp\" style=\"width: 50%\">                                                        <h3 class=\"book-header-2-formats-title\">Mercado de Segunda Mano</h3>                                                        <p style=\"margin:0;padding:0 0 0.75em 0\">                                <a href=\"/vender-libro/el-maestro-de-esgrima-pdl-ed-6e/9788466316927/1236710\" class=\"btn01 btn01b\">                                    Cómpralo en 2ª mano desde                                    <span id=\"fichaDesde\" style=\"color: #df8800!important; min-width: 30px; display: inline-block\">3,00€</span>                                </a>                            </p>                            <script>calcularConversion('3.00','46','fichaDesde');</script><p style=\"margin:0;padding:0 0 0.75em 0\"><a href=\"#\" class=\"btn01 btn01b\">¿Tienes un ejemplar? Véndelo ahora</a></p></div>                                      <div class=\"clear\"></div>                    </div>                    <div class=\"clear\"></div>                    <div class=\"clear\"></div>                                    </div>                                        <p class=\"priceOriginal\">6.00€</p>                <p class=\"currentPrice\">5.70€</p>                <div class=\"book-header-3\">                    <div id=\"divCompraProducto\" name=\"divCompraProducto\"><div class=\"style01\"><div class=\"title02\"><h3 class=\"item-status\">Disponible</h3>                                            <div class=\"clear\"></div>                                        </div>                                        <div class=\"book-header-3-price\"><strike class=\"old\">6.00 € </strike><span class=\"discount\"><span class=\"txtred\">-5.00%</span></span><span class=\"new\">5.70 € </span></div><ul class=\"list02\"><li class=\"first-child\"><span data-tooltip-left=\"Envío gratuito para España Península y Baleares para pedidos superiores a 19€ si eliges modo de envío en 3-5 días. Para otros destinos fuera de España descuento de 5 €\" class=\"note\"><img alt=\"Más información\" src=\"http://image.casadellibro.com/t1/css/_gfx/ico-info.png\">Envío <strong>GRATIS</strong> por compra superior a <strong>19€</strong></span></li>        <div class=\"clear\"></div>                        <li class=\"smaller last-child\"><span data-tooltip-left=\"Entrega en 3-5 días laborables con envío urgente para España Peninsular; para otras zonas dependerá de la forma de envío y de la zona de destino seleccionado.  La disponibilidad únicamente se refiere a casadellibro.com, y el cobro de tu pedido se realizará en el momento de su envío.\" class=\"note\"><img alt=\"Más información\" src=\"http://image.casadellibro.com/t1/css/_gfx/ico-info.png\">Entrega aproximada 5 días, eligiendo envío 3 a 5 días</span></li></ul><div class=\"btn-box pb10\"><a href=\"#\" class=\"btn05\"><span class=\"carrito\"></span> Añadir a mi compra</a></div><div class=\"separator\"></div><div class=\"clear\"></div>                                                <p><a href=\"#\" class=\"\">Accede para activar la Compra en 1 paso</a><br><a href=\"/comun/modalInfoCompra1Paso?lang=es\" class=\"open-popup-wide\">Información detallada</a></p></div>            </div>                                        <script>cargaJspAjax('divCompraProducto','/fichas/compraProducto?idproducto=1236710&lang=es&paiscache=63');</script>                    <div class=\"book-header-3-promo\">                        <div class=\"littlepromo\" style=\"float:none;width:270px\">                            <!-- N-CDL-Minipromo_ficha1 -->                            <script type=\"text/javascript\">                                GA_googleFillSlot(\"N-CDL-Minipromo_ficha1\");                            </script><script src=\"http://pubads.g.doubleclick.net/gampad/ads?correlator=2910521053413376&amp;output=json_html&amp;callback=GA_googleSetAdContentsBySlotForSync&amp;impl=s&amp;pstok=1Lu_BUJMTaYKDQoLCKKDsxgQ8rma8nE&amp;client=ca-pub-1668242218687246&amp;slotname=N-CDL-Minipromo_ficha1&amp;page_slots=N-CDL-Home-Superior90%2CN-CDL-Minipromo_ficha1&amp;cookie=ID%3De243d61028698a1f%3AT%3D1406554057%3AS%3DALNI_MZgrOPjvpElD4rAhUCb_YAxm1xDXg&amp;url=http%3A%2F%2Fwww.casadellibro.com%2Flibro-el-maestro-de-esgrima-pdl-ed-6e%2F9788466316927%2F1236710&amp;lmt=1407815167&amp;dt=1407825967769&amp;cc=40&amp;biw=1217&amp;bih=885&amp;adk=572650707&amp;adx=874&amp;ady=316&amp;ifi=2&amp;oid=3&amp;u_tz=180&amp;u_his=1&amp;u_java=true&amp;u_h=1024&amp;u_w=1280&amp;u_ah=1024&amp;u_aw=1280&amp;u_cd=24&amp;u_nplug=14&amp;u_nmime=26&amp;flash=14.0.0&amp;gads=v2&amp;ga_vid=168540623.1407825968&amp;ga_sid=1407825968&amp;ga_hid=434690875\"></script><div id=\"google_ads_div_N-CDL-Minipromo_ficha1_ad_wrapper\"><div id=\"google_ads_div_N-CDL-Minipromo_ficha1_ad_container\" style=\"display:inline-block;\"><ins style=\"width: 270px; height: 40px; display: inline-table; position: relative; border: 0px;\"><ins style=\"width: 270px; height: 40px; display: block; position: relative; border: 0px;\"><iframe id=\"google_ads_iframe_N-CDL-Minipromo_ficha1\" name=\"google_ads_iframe_N-CDL-Minipromo_ficha1\" width=\"270\" height=\"40\" scrolling=\"no\" marginwidth=\"0\" marginheight=\"0\" frameborder=\"0\" style=\"border: 0px; position: absolute; top: 0px; left: 0px;\"></iframe></ins></ins></div></div><script>GA_googleCreateDomIframe(\"google_ads_div_N-CDL-Minipromo_ficha1_ad_container\" ,\"N-CDL-Minipromo_ficha1\");</script>                        </div>                        <div class=\"clear pt10\"></div>                        <div class=\"littlepromo\" style=\"float:none;width:270px\">                            <!-- N-CDL-Minipromo_ficha2 -->                            <script type=\"text/javascript\">                                GA_googleFillSlot(\"N-CDL-Minipromo_ficha2\");                            </script><script src=\"http://pubads.g.doubleclick.net/gampad/ads?correlator=2910521053413376&amp;output=json_html&amp;callback=GA_googleSetAdContentsBySlotForSync&amp;impl=s&amp;pstok=QGDiQRgV4PoKDQoLCKKDsxgQ8rma8nEKDgoMCPK04RoQwo7fwpEB&amp;client=ca-pub-1668242218687246&amp;slotname=N-CDL-Minipromo_ficha2&amp;page_slots=N-CDL-Home-Superior90%2CN-CDL-Minipromo_ficha1%2CN-CDL-Minipromo_ficha2&amp;cookie=ID%3De243d61028698a1f%3AT%3D1406554057%3AS%3DALNI_MZgrOPjvpElD4rAhUCb_YAxm1xDXg&amp;url=http%3A%2F%2Fwww.casadellibro.com%2Flibro-el-maestro-de-esgrima-pdl-ed-6e%2F9788466316927%2F1236710&amp;lmt=1407815167&amp;dt=1407825967895&amp;cc=30&amp;biw=1217&amp;bih=885&amp;adk=744936942&amp;adx=874&amp;ady=275&amp;ifi=3&amp;oid=3&amp;u_tz=180&amp;u_his=1&amp;u_java=true&amp;u_h=1024&amp;u_w=1280&amp;u_ah=1024&amp;u_aw=1280&amp;u_cd=24&amp;u_nplug=14&amp;u_nmime=26&amp;flash=14.0.0&amp;gads=v2&amp;ga_vid=168540623.1407825968&amp;ga_sid=1407825968&amp;ga_hid=434690875\"></script>                        </div>                        <div class=\"clear\"></div>                    </div>                                    </div>                <div class=\"clear\"></div>            </div>";
	private static CasadelLibroParser parser;
	
	@BeforeClass 
	public static void parseDocument()
	{		
		Document bookInfo = Jsoup.parse(bookHtml);
		parser = new CasadelLibroParser(bookInfo, "9788466316927");
		try {
			parser.parseHtml();
		} catch (Exception e) {
			fail(e.getMessage());
		}
	}
	
	@Test
	public void CasaDelLibroParser_document_parsesTitle() {
		String title = parser.getTitle();
		
		assertEquals("EL MAESTRO DE ESGRIMA (PDL ED. 6E)", title);	
	}
	
	@Test
	public void CasaDelLibroParser_document_parsesAuthors() {
		List<String> authors = parser.getAuthors();
		
		assertEquals("ARTURO PEREZ-REVERTE",authors.get(0));	
	}
	
	@Test
	public void CasaDelLibroParser_document_parsesDescription() {
		String desc = parser.getDescription();
		
		assertEquals("Novela de aventuras pero también policiaca, de traiciones y maniobras políticas " +
			"en el Madrid galdosiano de 1868. El maestro de esgrima es la historia de un mund" +
			"o de tahúres y mercachifles mantenido a distancia por un florete honorable. Pero" +
			" es, sobre todo, una inquietante parábola sobre el poder del dinero, la ambición" +
			" polí tica y la extinción de los valores de honradez y fidelidad en este siglo X" +
			"X que agoniza.", desc);	
	}	
	
	@Test
	public void CasaDelLibroParser_document_parsesPageCountAndLanguage() {		
		String pageCount = parser.getPageCount();
		String language = parser.getLanguage();
		
		assertEquals("320", pageCount);
		assertEquals("es", language);		
	}
	
	@Test
	public void CasaDelLibroParser_document_parsesImage() {
		String imageLink = parser.getImageLink();
		
		assertEquals("http://image.casadellibro.com/a/l/t1/27/9788466316927.jpg", imageLink);
		assertTrue(parser.hasImage());
	}
	
	@Test
	public void CasaDelLibroParser_document_parsesCategory() {
		List<String> categories= parser.getCategories();
		
		assertEquals("Ciencia ficción en bolsillo", categories.get(0));
	}
}
